version: '3.7'

services:
  proxy:
    build: 
      context: .
      target: development
      
    restart: always
    image: preview-proxy
    environment:
      BASE_URL: ${BASE_URL:-http://local.livecycle.run:8030}
      SSH_HOST_KEY: LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJsd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFZRUFycCtuT1BheXNha2NUOE44Z0FyLy81c2lZVENDZ2RIMEtNeGNpM1N3dXRNMlpPck5ENHQyCkUxZmxldWJlSGlLYWlXbGovQXF0MVRuMDN1c2FMRVRlZFgwVVM2VlVEeE81YUl3N0JPdndTeXkxcHVjOGlsNk9WQmZSNHMKQTMvdVpkekFkVFZUVjhyOS85azNmUDRtNnV4Z1BvaDY4TmNKd2pzQStCUmkwdWxsU29lWTU2aWJ1OEY3THBLczBqR1gwQQpNNC9GYTVlTUxobjlHSDBGbUtYNi9vR1kwQytuZ2cvMjk0L2RFUWtMcmV5UlIyTWhuK0t5aVBXd1dCRjdxWTVURXFPaUtiClUydFFhS0gxQVNVbGNUVldUdGRIcUJTb2xERkx4K3k1WGdIcExMWmQvZ01vbFdaVFk5bFBNU21ZeXpDS05IL3lCMkkzNjIKdXRhMGlFRlFLU2dKc1NGL3hVZ2t3SWE5a2lLVTMyVVlHVlhzQjZmTDdvemFaWGU4SGdoaFhHN2ZJbGFiVkxtbCtzR242VgpSTUcwc0lGSHNiK1VFMG5pQndRYmxMUXZrTjJlWmp1L1BPUExMQmJObTJGVFQwNG5sb3FNM0U3SzFCZW45SGxRb3Q5Zmd1CkxXTUpJMUtmdndIRGprYXh2eGNVT2FOUE9uQWtvYWJkWmJwOWM0WE5BQUFGb0NKTlB5c2lUVDhyQUFBQUIzTnphQzF5YzIKRUFBQUdCQUs2ZnB6ajJzckdwSEUvRGZJQUsvLytiSW1Fd2dvSFI5Q2pNWEl0MHNMclRObVRxelErTGRoTlg1WHJtM2g0aQptb2xwWS93S3JkVTU5TjdyR2l4RTNuVjlGRXVsVkE4VHVXaU1Pd1RyOEVzc3RhYm5QSXBlamxRWDBlTEFOLzdtWGN3SFUxClUxZksvZi9aTjN6K0p1cnNZRDZJZXZEWENjSTdBUGdVWXRMcFpVcUhtT2VvbTd2QmV5NlNyTkl4bDlBRE9QeFd1WGpDNFoKL1JoOUJaaWwrdjZCbU5BdnA0SVA5dmVQM1JFSkM2M3NrVWRqSVovaXNvajFzRmdSZTZtT1V4S2pvaW0xTnJVR2loOVFFbApKWEUxVms3WFI2Z1VxSlF4Uzhmc3VWNEI2U3kyWGY0REtKVm1VMlBaVHpFcG1Nc3dpalIvOGdkaU4rdHJyV3RJaEJVQ2tvCkNiRWhmOFZJSk1DR3ZaSWlsTjlsR0JsVjdBZW55KzZNMm1WM3ZCNElZVnh1M3lKV20xUzVwZnJCcCtsVVRCdExDQlI3Ry8KbEJOSjRnY0VHNVMwTDVEZG5tWTd2enpqeXl3V3padGhVMDlPSjVhS2pOeE95dFFYcC9SNVVLTGZYNExpMWpDU05Tbjc4Qgp3NDVHc2I4WEZEbWpUenB3SktHbTNXVzZmWE9GelFBQUFBTUJBQUVBQUFHQVFhQnl3aS9FM0l3SHZkcGtFZU1RYnNtbzFBCm5kSWxqN2Y5RzkvaE11MENmTXk0U0s2SXFySjMzakdwdGxZc0h5Zmk0RGk1ZWYyUURkREdJakJmd2o5dGU1SnV6TmVKVWIKR3pXSWdNTURIZDJCcjJZOEZHeVE1UDNHdlljc0JEb2ppaWcrbzBsa3dOeFhlbktPeURSOHJxS05ZMkRnbGkrNElkVFI2cwpQVVBGODRxZVpvR3hkWkN6Y0w5aS8rUHZnQmVWOVEvS3lKM0ZHY0V2WDVnbkx1cjNPWk1MU1lLWU5DZDZ1emsxRm8rRVp1Ckd2d2dpT3d6Mk5FdEl3di9BNndlNFNTcVZ6d24rVDlkeEFOWGp3YmM2TDZZRkNIZnJxdlJBbVBBUjJ2b2I3WDAvZXNyYmYKTXZMTE03L1N6SFNGTnE5cmR0M2lEOEpGUmtuRXhZaTZWUmVxbXpuSkpFYndRYXhqZ01mK0NZTE9aclVBTU9LcnI2dkVNOAo2OFFBTmFMTWJqWllOOU14clVDWjVVcDZlZDBxVjJ4N2xycVZjTUswQTJHSk9oN0R5T1cwMGRBMitrYWYzSHNjL0dTQU9vClUvSmJ6R0twZFYyZjRJZmxIYk9GSk1SR1Fnc3JqN0VJamVTcStyZEp0d3BmRzlpRnR0aWxtRzFyQTM4RE1QQUlWQkFBQUEKd0hqaW4vWnFSZHEyNWlmbE9hcDZMbVFBSUZIVmJReW5BVllXK2NYMlVKOGpjMm1iellRMCtyYmg1UXVwcGl4M0psbERMZApKY3JKSVAwR1ZxMWVNZXVVTzFBRllnNVc0ZndRL3dmRm5NVzBEREEyR1kxVkFYSU41OVRuRnRUY0djOVFSUGRLdkhlb0haCmlIRHpoK01XZDU1dzJBVVd5MGdQV1VwQUQ0MS9XUllUV1VJMGJSblJEanlrVW5xdW0xTnUrNHQ0M3BwSzJMYjEyeVlwLzMKMHJHTUtkWXNMaEsxQlNNbU81bVh6Z2V3ODRBQUw3dWtCQUk5SFZ0b2kzWHNTUjRRQUFBTUVBNFd3Zk04M2hjQngrTnhHTAp1Y3lEWG04cUhPNnFoVk0rc0hwbVYyaUp0UE5xZDd5Rkc1SGVtbkU3WVdLQkFURGoyRzlOVWttd0NKNGprUHAvRm1NeTRvClVyYnJUSGViNXZSQXhkTkdRQU1oZDFFQXBYQnlzcFZuS0F4b1RJdWpqNjhIVFQ0YnY0cHFQU3k5MWdMejBMSStDSkFFUFgKdDF3MVBKVFUydDRQVk1HaGVXNWpzZUpFbzZyelF5OE5Ubjcrc3lGdHFaaUtkN095R0NrOWdFL1NpQmxOTXR1eFJrSHJDSgp2c0IxUUR4eUJydzAzcTF2Q3dvWHhwMVBGRy8wRlZBQUFBd1FER1Q0YlQvbXBsU1pqS3B1SmVtZ2R2ZUtJeTZ6eEZWSjZ5ClB0M1NDQXZFb0hrYmlXTnZTWHYrREdnenc3NUJvQkFHQ3FXekpraW9taGhOSUh6SndsODI3ZU5VTGJrTkJocTlVN1EwSGIKOEJnZ1VCQ2VsMjRhWGRuZnhyWFlJdkg2NXJjdkRFWWhQU2xlTEJGbUdBQTR1QlFCbVBiQ3Rob3NLVGhnZVZsazJmMU44Nwp6ekkzTStDVkoyTW5MVzJQOWloTE15L3pIVndKTm52UnU4ZHB3U1lLRUtJV1RlaTgzYW5qQWk4MDQ4aFZjUXBacloyejJoCk13dHYyQ0ZDa1hrcGtBQUFBbmVYTm9ZWGw1WVdGamIySnBRRmx6YUdGNWN5MU5ZV05DYjI5ckxWQnlieTB6TG14dlkyRnMKQVFJREJBPT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCg==

    ports:
      - '8030:3000'
      - '2223:2222'

    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:3000/healthz || exit 1
      interval: 10s
      retries: 4
      start_period: 20s
      timeout: 10s
